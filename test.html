<html>
<head>
	 <meta charset="UTF-8"> 
<title>Test</title>
<style>
	html, body {
		position: relative;
		width: 100%;
		height: 100%;
		padding: 0;
		margin: 0;
		overflow-x: hidden;
		background-color: gray;
	}

	.test {
		background-color: #E4CAAC;
	}

	.square-grid {
		position: relative;
		width: 100%;
		height: 50%;
	}

	.square-block {
		width: 8.9%;
		padding-bottom: 8.9%;
		margin-right: 1%;
		margin-bottom: 1%;
		float: left;
	}

	.width-2 {
		width: 18.8%;
	}

	.height-2 {
		padding-bottom: 18.8%;
	}

	.square-grid-10:nth-child(10n) {
		margin-right: 0;
	}

	.square-grid-10:nth-child(10n+1) {
		margin-left: 1%;
	}

	.square-grid-10:nth-child(-n+11) {
		margin-top: 1%;
	}


</style>
</head>
<body>

	<div id="square-grid" class="square-grid-10">
		<div class="square-block width-3 height-2 test"></div>
		<div class="square-block test"></div>
		<div class="square-block width-2 test"></div>
		<div class="square-block height-2 test"></div>
		<div class="square-block test"></div>
		<div class="square-block test"></div>
		<div class="square-block test"></div>
		<div class="square-block test"></div>
		<div class="square-block height-2 test"></div>
		<div class="square-block test"></div>

		<div class="square-block test"></div>
		<div class="square-block test"></div>
		<div class="square-block test"></div>
		<div class="square-block test"></div>
		<div class="square-block test"></div>
		<div class="square-block test"></div>
		<div class="square-block test"></div>
		<div class="square-block test"></div>
		<div class="square-block test"></div>
		<div class="square-block test"></div>
	</div>

	<div id="test">
		<div data-tile-id="0" class="child"></div>
		<div data-tile-id="1" class="child"></div>
	</div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script>
		var $container = $("#square-grid");
		var numCols = 10;
		var colMax = 9;
		var elmnts;

		var newRow = [10, 9, 8, 7, 6, 5, 4, 3, 2, 1];

		// Retirns a copy of a new row
		var getNewRow = function(){
			return newRow.slice(0);
		}

		var grid = [getNewRow()];


		var defaultRow = 0; // The next available row to fill
		var defaultCol = 0; // The next available column to fill

		// Gets all the children of the container element
		var getBlocks = function() {
			elmnts= $container.children();
		}
		

		// Parses the classes of the DOM element
		// to determine the specified position
		// and sizing of it.
		var parseElement = function(element) {
			var classes = element.classList;
			var elemInfo = {
				row: -1,
				col: -1,
				width: 1,
				height: 1
			}

			for(var i = 0; i < classes.length; i++) {
				var split = classes[i].split("-");
				var critical = split[0];
				switch (critical) {
					case 'row':
						elemInfo.row = parseInt(split[1]);
						break;
					case 'col':
						elemInfo.col = parseInt(split[1]);
						if (elemInfo.col > colMax) {
							console.error("[Mosaic] Error: Element assigned to column " + elemInfo.col + ", but column maximum is " + colMax + ". Reassigned to column maximum.");
							elemInfo.col = colMax;
						}
						break;
					case 'width':
						elemInfo.width = parseInt(split[1]);
						break;
					case 'height':
						elemInfo.height = parseInt(split[1]);
						break;
				}
			}

			return elemInfo;
		}

		var incrementRow = function(row) {
			row++;
			if (grid[row] == undefined) {
				grid[row] = getNewRow();
				printGrid();
			}
			return row;
		}

		var checkNextPos = function(row, col) {
			// If beyond grid bounds or on a filled slot,
			// keep iterating through
			while (col > colMax || grid[row][col] < 0) {
				if (col > colMax) {
					row = incrementRow(row);
					col = 0;
				} else {
					col = col + (-1 * grid[row][col]);
				}
			}

			return {row: row, col: col};
		}

		var findDefaultPosition = function(element) {
			var row = defaultRow;
			var col = defaultCol;

			var topRow = row;
			var leftCol = col;

			// Loop through finding process until a slot is found
			while (row - topRow < element.height) {
				// If the width of the element doesn't fit,
				// find next possible position
				if (!(grid[row][col] - element.width >= 0)) {
					// Go to end of free space
					col = col + grid[row][col];

					var rowCol = checkNextPos(row, col);

					// Reset positional topRow and leftCol
					topRow = row = rowCol.row;
					leftCol = col = rowCol.col;
				} else {
					row = incrementRow(row);
				}
			}

			element.row = topRow;
			element.col = leftCol;
			fillPosition(element);

			// If the default pos is now taken
			if (topRow == defaultRow && leftCol == defaultCol) {
				// Find next default position
				var newCol = defaultCol + (-1 * grid[defaultRow][defaultCol]);
				var defRowCol = checkNextPos(defaultRow, newCol);
				defaultRow = defRowCol.row;
				defaultCol = defRowCol.col;
			}
			
			return element;
		}

		// Takes the given element and fills the grid
		var fillPosition = function(element) {
			var maxRow = parseInt(element.row) + parseInt(element.height);
			var maxCol = parseInt(element.col) + parseInt(element.width);

			for (var i = element.row; i < maxRow; i++) {
				for (var k = element.col - 1; k >= 0; k--) {
					if (grid[i][k] < 0)
						break;
					else
						grid[i][k] = element.col - k;
				}

				for (var j = element.col; j < maxCol; j++) {
					grid[i][j] = j - element.col - element.width;
				}
			}

			printGrid();
		}

		var printGrid = function() {
			for (var i = 0; i < grid.length; i++) {
				console.log(i + ": " + grid[i].join("\t"));
			}
		}

		var printElement = function(element) {
			console.log("Element width: " + element.width + ", height: " + element.height + ", row: " + element.row + ", col: " + element.col);
		}

/*
		getBlocks();
		printGrid();
		for(var i = 0; i < elmnts.length; i++) {
			var el = findDefaultPosition(parseElement(elmnts[i]));
			printElement(el);
		}*/

		
		var tiles = {};
		var children = $('#test').children();
		tiles[children[0].getAttribute("data-tile-id")] = 1;
		tiles[children[1].getAttribute("data-tile-id")] = 2;
		console.log(tiles[children[0].getAttribute("data-tile-id")] + ", " + tiles[children[1].getAttribute("data-tile-id")]);
		

		/*
		var findDefaultPosition1 = function(element) {
			// Checking if there's space to the right to accommodate element
			for (var right = 1; right < element.width; right++) {
				// TODO: Make sure you don't create array slot beyond grid bounds
				console.log("Checking grid[" + defaultRow + "][" + defaultCol + " + " + right + "] = " + grid[defaultRow][defaultCol+right]);

				var slot = grid[defaultRow][defaultCol+right];
				if (slot != undefined && slot != 0) {
					break;
				}
			}

			// Checking if there's space below to accommodate element
			for (var bottom = 1; bottom < element.height; bottom++) {
				var row = grid[defaultRow+bottom];
				if (row == undefined) {
					row = [];
					console.log("Adding a row: " + row[defaultCol]);
					continue;
				}

				var slot = grid[defaultRow+bottom][defaultCol];

				console.log("Checking grid[" + defaultRow + "+" + bottom + "][" + defaultCol + "] = " + slot);
				
				if (slot != undefined && slot != 0) {
					break;
				}
			}
		}*/
	</script>

</body>
</html>